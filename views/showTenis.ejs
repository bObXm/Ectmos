<!DOCTYPE html>
<html lang="en">
<%- include('partial/head.ejs') %>

<body>
    <%- include('partial/navbar.ejs') %>
    <%- include('partial/flash.ejs')%>

    <div class="row">
        <div class="col-6 me-5">
            
            <div class="card mb-3 ">
                <%- include('partial/anuntBase.ejs', {anunt: anunt}); %>
                <ul class="list-group list-group-flush ">
                    <li class="list-group-item darkkkk">
                        <h5>Team</h5>
                        <% for(let echipa of anunt.team.partener) {%>
                            <h5> <%=echipa.username %> </h5>
                        <% } %>
                        <%  if( currentUser && !anunt.author.equals(currentUser._id))  {%>
                            <br />
                            <h5>
                                <% if(currentUser) { %>
                                    <button onclick="addParticipant('partener', '<%=anunt.id%>')">Add me as player</button>
                                <% } %>
                            </h5>
                        <% } %>
                    </li>
                    <li class="list-group-item autor">Anunt creat de cÄƒtre: <%= anunt.author.username%></li>
                </ul>
                <%  if( currentUser && anunt.author.equals(currentUser._id))  {%>
                <div class="card-body darkkkk">
                    <a class="card-link btn btn-info" href="/anunturiTenis/<%= anunt.id %>/edit ">Modify</a>
                    <form class="d-inline" action="/anunt/tenis/<%= anunt.id %>?_method=DELETE" method="POST">
                        <button class="btn btn-danger">Delete</button>
                    </form>
                </div>
                <% } %>
                <div class="card-footer text-muted darkkkk">
                    <a href="/anunturi/tenis">
                        < Back to list</a>
                </div>
            </div>
        </div>
        <div class="col-5">
            <div id='map' class="mb-3" style='width: 100%; height: 400px;'></div>
            <%- include('partial/showReviews', {currentUser: currentUser, anunt: anunt}); %>
        </div>
    </div>

    <script type="text/javascript">
        function addParticipant(pozitie, idAnunt) {
            fetch(`./../../anunt/adauga-membru/${idAnunt}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ pozitie: pozitie, user: "<%=currentUser ? currentUser.id : ''%>" })
            })
                .then(response => response.json())
                .then(result => {
                    console.log('Success:', result);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    </script>


    <%- include('partial/initMapDetails', {anunt: anunt}); %>
    <%- include('partial/script.ejs') %>
</body>

</html>