<!DOCTYPE html>
<html lang="en">
    <%- include('partial/head.ejs') %> 
<body>
    <%- include('partial/navbar.ejs') %> 


    <%- include('partial/flash.ejs')%>
    

    <div class="row">
        <div class="col-6 me-5">
             <!-- cap55 curs4 -->
        <div id='map' class="mb-3" style='width: 100%; height: 400px;'></div>
            <div class="card mb-3 ">
                <div class="card-body darkkkk">
                    <h5 class="card-title">Sport:<%= anunt.sport %> </h5>
                    <p class="card-text">  
                        <h2>Nivel de dificultate:<%= anunt.dificultate %> </h2>
                        <h2>Organizator:<%= anunt.organizator %> </h2>
                        <h2>Nr de telefon al organzatorului:<%= anunt.telefon %> </h2>
            
                        <h2>Data:<%=anunt.dataSiOra.toDateString() %> </h2>
                        <h2>Ora:<%= ora%></h2></p>
                </div>
                <ul class="list-group list-group-flush ">
                    <li class="list-group-item darkkkk"><h2>Locatie:<%= anunt.info %> </h2></li>
                    <li class="list-group-item darkkkk"><h2>Parteneri:</h2>
                        <h2>Simplu:<%= anunt.simplu %> </h2>
                        <h2>Dublu:<%= anunt.dublu %> </h2>
                    </li>
                    <!-- cap52curs1 -->
                    <li class="list-group-item autor">Submitted by <%= anunt.author.username%></li>
                </ul>
                 <!-- cap52curs2 -->
                 <%  if( currentUser && anunt.author.equals(currentUser._id))  {%>
                <div class="card-body darkkkk">
                    <a class="card-link btn btn-info" href="/anunturiTenis/<%= anunt.id %>/edit ">Editeaza anuntul</a>
                    <form class="d-inline" action="/anunt/tenis/<%= anunt.id %>?_method=DELETE" method="POST">
                        <button class="btn btn-danger">Sterge anuntul</button>
                    </form>
                </div>
                <% } %> 
                <div class="card-footer text-muted darkkkk">
                    <a href="/anunturi/tenis">Inapoi la toate anunturile</a>
                </div>
            </div>
        </div>
            <!-- cap46 curs2 -->
            <!-- pt review[] cap39 curs8 min 1:30 -->
            <div class="col-5">
                <!-- cap52curs5 -->
                <% if(currentUser){ %>
                <h2>Leave a Review</h2>
                <form action="/anunt/<%= anunt.sport %>/<%=anunt._id%>/reviews" method="POST"  class="mb-3 validated-form" novalidate>
                   <!-- cap53curs5 -->
                   <div class="mb-3">
                    <fieldset class="starability-slot">
                       
                        <input type="radio" id="no-rate" class="input-no-rate" name="review[rating]" value="1" checked aria-label="No rating." />
                        <input type="radio" id="first-rate1" name="review[rating]" value="1" />
                        <label for="first-rate1" title="Terrible">1 star</label>
                        <input type="radio" id="first-rate2" name="review[rating]" value="2" />
                        <label for="first-rate2" title="Not good">2 stars</label>
                        <input type="radio" id="first-rate3" name="review[rating]" value="3" />
                        <label for="first-rate3" title="Average">3 stars</label>
                        <input type="radio" id="first-rate4" name="review[rating]" value="4" />
                        <label for="first-rate4" title="Very good">4 stars</label>
                        <input type="radio" id="first-rate5" name="review[rating]" value="5" />
                        <label for="first-rate5" title="Amazing">5 stars</label>
                      </fieldset>

                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="body">Review text</label>
                        <textarea class="form-control" name="review[body]" id="body" cols="30" rows="3" required></textarea>
                        <div class="valid-feedback">
                            Looks good!
                        </div>
                    </div>
                    <button class="btn btn-success">Submit</button>
                </form>
                <% } %> 
            
                <% for(let review of anunt.reviews) { %>
                    <div class="card mb-3 ">
                        <div class="card-body darkkkk">
                            <!-- cap53curs4 -->
                            <h5 class="card-title"><%= review.author.username%></h5>
                            <p class="starability-result" data-rating="<%= review.rating %>">
                              Rated: <%= review.rating %> stars
                            </p>
                            <!-- cap52curs6 -->
                            <p class="card-text">Review: <%= review.body %></p>

                            <!-- cap52curs6 -->
                            <%  if( currentUser && review.author.equals(currentUser._id))  {%>
                            <form action="/anunt/<%= anunt.sport %>/<%=anunt._id%>/reviews/<%=review._id%>?_method=DELETE" method="POST">
                                <button class="btn btn-sm btn-danger">Delete</button>
                            </form>
                            <% } %> 
                        </div>
                    </div>
                <% } %>
            </div>

    </div>






    <script>
        const mapToken = '<%-process.env.MAPBOX_TOKEN%>';
        const anuntjs =JSON.parse('<%-JSON.stringify(anunt)%> ')
    
    
        mapboxgl.accessToken = mapToken;
    
        const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v10', // stylesheet location
        center: anuntjs.geometry.coordinates, // starting position [lng, lat]
        zoom: 10 // starting zoom
    });
    
    new mapboxgl.Marker()
        .setLngLat(anuntjs.geometry.coordinates)
        .setPopup(
            new mapboxgl.Popup({ offset: 25 })
                .setHTML(
                    `<h5 class='pp'>${anuntjs.info}</h5>`
                )
        )
        .addTo(map)
    
    </script>












    <%- include('partial/script.ejs') %>

</body>
</html>